<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="careProfile">

	<!-- 프로필 사진만 -->
	<select id="getProPic" resultType="com.wt.app.dto.CareProfilePictureDTO">
		SELECT fp.PROFILES_FILES_TYPE, fp.PROFILES_FILES_NAME, fp.PROFILES_FILES_PATH
		FROM RICEBALL.TBL_FILES_PROFILES fp
		WHERE USERS_NUMBER = #{usersNumber}
	</select>

	<!-- 프로필 정보 조회 -->	
	<select id="getProfile" resultType="CareProfileDTO">
		<![CDATA[
			SELECT u.USERS_NUMBER, 
			d.DAY_MONDAY, d.DAY_TUESDAY, d.DAY_WEDNESDAY, d.DAY_THURSDAY, 
    		d.DAY_FRIDAY, d.DAY_SATURDAY, d.DAY_SUNDAY,
    		fp.PROFILES_FILES_TYPE, fp.PROFILES_FILES_NAME, fp.PROFILES_FILES_PATH, fp.PROFILES_FILES_SIZE_BYTES,
    		fl.LICENSE_FILES_TYPE, fl.LICENSE_FILES_NAME, fl.LICENSE_FILES_PATH, fl.LICENSE_FILES_SIZE_BYTES,
    		fa.ACCOUNT_FILES_TYPE, fa.ACCOUNT_FILES_NAME, fa.ACCOUNT_FILES_PATH, fa.ACCOUNT_FILES_SIZE_BYTES,
    		u.USERS_POSTSAL_CODE, u.USERS_ADDRESS_LINE1, u.USERS_ADDRESS_LINE2,
    		cu.CARE_INTRO_TEXT
		FROM RICEBALL.TBL_USERS u
		LEFT JOIN RICEBALL.TBL_DAY d 
    		ON u.USERS_NUMBER = d.USERS_NUMBER
		LEFT JOIN RICEBALL.TBL_FILES_PROFILES fp 
    		ON u.USERS_NUMBER = fp.USERS_NUMBER
		LEFT JOIN RICEBALL.TBL_FILES_LICENSE fl 
    		ON u.USERS_NUMBER = fl.USERS_NUMBER
		LEFT JOIN RICEBALL.TBL_FILES_ACCOUNT fa 
    		ON u.USERS_NUMBER = fa.USERS_NUMBER
		LEFT JOIN RICEBALL.TBL_CARE_USERS cu 
    		ON u.USERS_NUMBER = cu.USERS_NUMBER
		WHERE u.USERS_NUMBER = #{usersNumber}
		]]>
	</select>
	
	<select id="checkDay" resultType="int">
		SELECT COUNT(USERS_NUMBER) FROM RICEBALL.TBL_DAY WHERE USERS_NUMBER = #{usersNumber}
	</select>
	
	<!-- 요일 정보 insert -->
	<insert id="insertDay" parameterType="CareProfileDTO">
		INSERT INTO RICEBALL.TBL_DAY (USERS_NUMBER, DAY_MONDAY, DAY_TUESDAY, DAY_WEDNESDAY, DAY_THURSDAY, DAY_FRIDAY, DAY_SATURDAY, DAY_SUNDAY) VALUES (#{usersNumber}, #{dayMonday}, #{dayTuesday}, #{dayWednesday}, #{dayThursday}, #{dayFriday}, #{daySaturday}, #{daySunday})
	</insert>
	
	
	<!-- 요일 정보 update -->
   <update id="updateDay">
		UPDATE RICEBALL.TBL_DAY SET DAY_MONDAY = #{dayMonday}, DAY_TUESDAY = #{dayTuesday}, DAY_WEDNESDAY = #{dayWednesday}, DAY_THURSDAY = #{dayThursday}, DAY_FRIDAY = #{dayFriday}, DAY_SATURDAY = #{daySaturday}, DAY_SUNDAY = #{daySunday} WHERE USERS_NUMBER = #{usersNumber}
   </update>
   
	<!-- 주소 update -->
   <update id="updateAddr">
		UPDATE RICEBALL.TBL_USERS SET USERS_POSTSAL_CODE=#{usersPostsalCode}, USERS_ADDRESS_LINE1=#{usersAddressLine1}, USERS_ADDRESS_LINE2=#{usersAddressLine2} WHERE USERS_NUMBER = #{usersNumber}
   </update>
	
	<!-- 프로필 사진 정보 update -->
   <update id="updateProPic">
		UPDATE RICEBALL.TBL_FILES_PROFILES SET PROFILES_FILES_TYPE = #{profilesFilesType}, PROFILES_FILES_NAME = #{profilesFilesName}, PROFILES_FILES_PATH = #{profilesFilesPath}, PROFILES_FILES_SIZE_BYTES = #{profilesFilesSizeBytes} WHERE USERS_NUMBER = #{usersNumber}
   </update>
	
	<!-- 소개글 update -->
   <update id="updateIntro">
		UPDATE RICEBALL.TBL_CARE_USERS SET CARE_INTRO_TEXT = #{careIntroText} WHERE USERS_NUMBER = #{usersNumber}
   </update>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	

	<!-- 프로필 사진 조회 -->
	<select id="profileSelect" resultType="CareProfileDTO">
		SELECT c.care_number, u.users_name, p.profiles_files_path
		FROM   tbl_users c
		join tbl_users u
		on c.users_number = c.users_number
		left JOIN   tbl_files_profiles p
       	ON c.care_profiles_photo_number = p.profiles_files_number
		WHERE  c.care_number = #{careNumber}
	</select>
	
	<!-- 프로필 사진 삭제 -->
	<delete id="profilrDelete" parameterType="CareProfileDTO">
		DELETE FROM tbl_files_profiles
		WHERE profiles_files_number = #{profilesFilesNumber}
	</delete>
	
	<!-- 프로필 사진 추가 -->
	<insert id="profileInsert" parameterType="CareProfileDTO">
		INSERT INTO tbl_files_profiles
		VALUES (#{profilesFilesNumber}, #{profilesFilesType}, #{profilesFilesName},#{profilesFilesPath},
		#{profilesFilesSizeBytes},#{profilesCreatedDate})	
	</insert>
	
	<!-- 프로필 요일 조회 -->
	<select id="daySelect" resultType="CareProfileDTO">
		SELECT day_monday,day_tuesday,day_wednesday,day_thursday,day_friday,day_saturday,day_sunday
    	FROM   tbl_day
    	WHERE  care_number = #{careNumber}
	</select>
	
	<!-- 프로필 주소 조회 -->
	<select id="addressSelect" resultType="CareProfileDTO">
		SELECT users_id, users_postsal_code, users_address_line1, users_address_line2
		FROM   tbl_users 
		WHERE  users_number = #{usersNumber}
	</select>
	
	<!-- 프로필 소개글 조회 -->
	<select id="introSelect" resultType="CareProfileDTO">
		SELECT users_number, care_intro_text
		FROM  tbl_care_users
		WHERE  users_number = #{usersNumber}
	</select>
	
	<!-- 프로필 요일 수정 쿼리작성 -->
	<update id="dayUpdate" parameterType="CareProfileDTO">
		update tbl_day set day_monday = #{dayMonday},
		day_tuesday = #{dayTuesday}, day_wednesday = #{dayWednesday},
		day_thursday = #{dayThursday}, day_friday = #{dayFriday},
		day_saturday
		= #{daySaturday}, day_sunday = #{daySunday}
		where tbl_day.care_number =
		#{careNumber}
	</update>

	<!-- 프로필 자격증 이력 수정 쿼리작성 -->
	<update id="licenseUpdate" parameterType="CareProfileDTO">
		update tbl_license_modify
		set license_files_type=#{licenseFilesType}, license_files_name = #{licenseFilesName},
		license_files_path = #{licenseFilesPath}, license_files_size_bytes=#{licenseFilesSizeBytes}, license_created_date=#{licenseCreatedDate}
    	WHERE users_number = #{usersNumber};
	</update> 
	
	

	<!-- 프로필 주소 수정 쿼리작성 -->
	<update id="addressUpdate" parameterType="CareProfileDTO">
		UPDATE tbl_users
		SET users_postsal_code  = #{usersPostsalCode},
    		users_address_line1 = #{usersAddressLine1},
    		users_address_line2 = #{usersAddressLine2}
		WHERE users_number = #{usersNumber}
	</update>

	<!-- 프로필 소개글 수정 쿼리작성 -->
	<update id="introUpdate" parameterType="CareProfileDTO">
		update tbl_care_users set care_intro_text =
		#{careIntroText}
		where care_number = #{careNumber}
	</update>


	

		

	

</mapper>