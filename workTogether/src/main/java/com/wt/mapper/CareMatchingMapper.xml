<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="careMatching">
	<!-- 매칭 추가 -->
	<insert id="matchingAdd" parameterType="CareMatchingDTO">
		<selectKey keyProperty="matchingNumber" resultType="int" order="BEFORE">
			SELECT seq_matchings.CURRVAL FROM DUAL
		</selectKey>
		INSERT INTO tbl_matchings (match_number, care_number, normal_number, match_date, match_match_time, match_points, match_status)
		VALUES (#{matchNumber},#{careNumber},(SELECT users_number FROM tbl_users WHERE users_id = #{usersId}),#{ matchDate},#{matchMatchTime},#{matchPoints},#{matchStatus});
	</insert>


	<!-- 매칭기록 조회 -->
	<select id="matchingMonth" parameterType="CareMatchingDTO">
		<![CDATA[
		SELECT * FROM (
			SELECT ROWNUM AS rnum, subquery.*
			FROM (
				SELECT m.match_date, n.users_name, m.match_match_time, m.match_points, m.match_status
				FROM tbl_matchings m JOIN tbl_normal_users n 
				ON m.normal_number = n.users_number
				where m.care_number = #{usersNumber}
				ORDER BY m.match_date DESC;
			) subquery
		) WHERE rnum BETWEEN #{startRow} AND #{endRow}	
		]]>
	</select>

</mapper>



