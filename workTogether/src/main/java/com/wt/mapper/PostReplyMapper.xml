<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="postReply">

<!-- 댓글 달기 -->
	<insert id="replyAdd" parameterType="PostReplyDTO">
		INSERT INTO TBL_REPLY
		(REPLY_NUMBER, POSTS_NUMBER, USERS_NUMBER, REPLY_CONTENT, REPLY_CREATED_DATE, REPLY_UPDATED_DATE)
		VALUES(seq_board_comments.nextval, #{postsNumber}, #{usersNumber}, #{replyContent}, sysdate, sysdate)
	</insert>
	
	<!-- 댓글 수정 -->
	<update id="replyUpdate" parameterType="PostReplyDTO">
		UPDATE TBL_REPLY
    	SET REPLY_CONTENT = #{replyContent}, REPLY_UPDATED_DATE = sysdate
    	WHERE REPLY_NUMBER = #{replyNumber}
	</update>
	
	<select id="listAll" resultType="PostReplyDTO">
		SELECT r.reply_number, r.posts_number, r.users_number, r.reply_content, r.reply_created_date, r.reply_updated_date, u.users_type, COALESCE(nu.users_name, cu.users_name) AS users_name
		FROM tbl_reply r
		JOIN tbl_users u ON r.users_number = u.users_number
		LEFT JOIN tbl_normal_users nu ON u.users_type = 'N' AND u.users_number = nu.users_number
		LEFT JOIN tbl_care_users cu ON u.users_type = 'C' AND u.users_number = cu.users_number
		WHERE r.posts_number = #{postsNumber}
		ORDER BY r.reply_created_date DESC
	</select>
	
	<delete id="replyDelete">
		delete tbl_reply
		where reply_number = #{replyNumber}
	</delete>

</mapper>